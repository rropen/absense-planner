{% extends 'base.html' %}
{% block title %}Teams Dashboard{% endblock %}
{% load static %}
{% block content %}

<div class="container">
    <div class="columns">
        <div class="column is-half">
            <a id="create" class="column button is-medium is-success icon-text" href="{% url 'create_team' %}">
                </i>Create A Team<i class="fas fa-plus ml-3"></i>
            </a>
        </div>

        <div class="column is-half">
            <a id="join" class="column button is-medium is-info icon-text" href="{% url 'join_team' %}">
                </i>Join A Team<i class="fas fa-user-friends ml-3"></i>
            </a>
        </div>
    </div>

    <div class="level">
        <div class="level-left">
            <h3 class="has-text-weight-bold is-size-5 my-3">Teams ({{external_teams|length}})</h3>
        </div>
    </div>

    {% if not external_teams %}
    <div class="container has-background-light box">
        <div class="is-size-5 mb-3">
            <span class="is-block is-size-5">No teams found.</span>
        </div>
    </div>
    {% else %}
    {% for team in external_teams %}
    <div class="container has-background-light box">
        <div class="is-size-5 mb-3">
            <span class="is-block is-size-5	has-text-weight-bold">{{ team.team.name }} <i class="fas fa-users mx-1"></i>{{ team.team.members|length }}
                {% if team.favourite %}
                <button class="button is-ghost" style="color: gold !important; padding-top: 0px!important; padding-bottom: 10px!important;" onclick="favouriteTeam(this, '{{ request.user.username }}', {{ team.team.id }})" onmouseover="starHover(this)" onmouseout="removeHover(this)" data-star="True"><i class="fas fa-star"></i></button>
                {% else %}
                <button class="button is-ghost" style="color: gold !important; padding-top: 0px!important; padding-bottom: 10px!important;" onclick="favouriteTeam(this, '{{ request.user.username }}', {{ team.team.id }})" onmouseover="starHover(this)" onmouseout="removeHover(this)" data-star="false"><i class="far fa-star"></i></button>
                {% endif %}
            </span>
            {% if team.team.private %}
                <span class="tag is-info is-rounded">
                    <i class="fas fa-lock"></i>&nbsp;Private
                </span>
            {% else %}
                <span class="tag is-info is-rounded">
                    <i class="fas fa-unlock"></i>&nbsp;Public
                </span>
            {% endif %}
            {% if team.role.role == "Owner" or team.role.role == "Co-Owner" %}
                <span class="tag is-dark is-rounded">
                    <i class="fas fa-user-edit"></i>
                    &nbsp;{{ team.role.role }}
                </span>
            {% else %}
                <span class="tag is-dark is-rounded">
                    <i class="fas fa-user"></i>
                    &nbsp;{{ team.role.role }}
                </span>
            {% endif %}
        </div>
        <span class="is-block is-size-6">{{team.team.description}}</span>
        <div class="level-right mt-3">
            <a class="button is-link mx-1" href={% url 'api_team_calendar' id=team.team.id %}>View</a>
            {% if team.role.role == "Owner" or team.role.role == "Co-Owner"%}
            <a class="button is-info mx-1" href={% url 'edit_team' id=team.team.id %}>Edit</a>
            {% endif %}
            <button class="button is-danger mx-1 leave-team-button" title="Leave" id="{{ team.team.id }}" onclick="openLeaveTeamModal('{{ team.team.id }}', '{{ csrf_token }}', '{{ request.user.username }}', '{{team.team.name}}')">Leave</button>
        </div>
    </div>
    {% endfor %}
    {% endif %}
    
</div>

<!-- Confirmation Modal -->
<div id="leaveTeamModal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <div class="box">
            <h1 class="title">Confirm Leave</h1>
            <p>Are you sure you want to leave this team?</p>
            <div class="buttons is-right">
                <button id="confirmLeaveButton" class="button is-danger">Leave</button>
                <button id="cancelLeaveButton" class="button">Cancel</button>
            </div>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>


<div id="successModal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <div class="box">
            <h1 class="title">Success</h1>
            <p id="success-modal-team-message">You have successfully left the team.</p>
            <div class="buttons is-right">
                <button id="closeSuccessButton" class="button is-success">OK</button>
            </div>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>

<script src="{% static 'js/teams.js' %}" apiURL="{{ url }}"></script>
{% endblock %}