{% extends 'base.html' %}
{% block title %}Teams Dashboard{% endblock %}
{% load static %}
{% block content %}

<div class="container">
    <div class="columns">
        <div class="column is-half">
            <a id="create" class="column button is-medium is-success icon-text" href="{% url 'create_team' %}">
                </i>Create A Team<i class="fas fa-plus ml-3"></i>
            </a>
        </div>

        <div class="column is-half">
            <a id="join" class="column button is-medium is-info icon-text" href="{% url 'join_team' %}">
                </i>Join A Team<i class="fas fa-user-friends ml-3"></i>
            </a>
        </div>
    </div>

    <div class="level">
        <div class="level-left">
            <h3 class="has-text-weight-bold is-size-5 my-3">Teams ({{teams|length}})</h3>
        </div>
    </div>

    {% if not teams %}
    <div class="container has-background-light box darkInput">
        <div class="is-size-5 mb-3">
            <p>You haven't joined any teams yet!</p>
            <br />
            <p>Consider joining a <a href="/teams/join"> team </a> or <a href="/teams/create">creating a team</a>. </p>
        </div>
    </div>
    {% else %}
    {% for team in teams %}
    <div class="container has-background-light box darkInput">
        <div class="is-size-5 mb-3">
            <span class="is-flex is-flex-direction-row is-justify-content-start is-align-items-center is-size-5 has-text-weight-bold team-name-bar">
                <span>{{ team.team.name }}</span>
                <span>
                    <i class="fas fa-users mx-1"></i>
                    <span>{{ team.team.members|length }}</span>
                </span>
                <form action="" method="POST" class="button is-ghost is-align-content-center" style="color: gold !important; padding: 0">
                    {% csrf_token %}
                    <input type="hidden" name="method" value="favourite">
                    <input type="hidden" name="team" value="{{ team.team.id }}">
                    <button
                        onmouseover="starHover(this)"
                        onmouseout="removeHover(this)"
                        data-star="{{ team.favourite }}"
                        type="submit"
                    >
                        <i class="
                            {% if team.favourite %}
                                fas
                            {% else %}
                                far
                            {% endif %}
                            fa-star
                        "></i>
                    </button>
                </form>
                
            </span>
            {% if team.team.private %}
                <span class="tag is-info is-rounded">
                    <i class="fas fa-lock"></i>&nbsp;Private
                </span>
            {% else %}
                <span class="tag is-info is-rounded">
                    <i class="fas fa-unlock"></i>&nbsp;Public
                </span>
            {% endif %}
            {% if team.role.role == "Owner" or team.role.role == "Co-Owner" %}
                <span class="tag is-dark is-rounded">
                    <i class="fas fa-user-edit"></i>
                    &nbsp;{{ team.role.role }}
                </span>
            {% else %}
                <span class="tag is-dark is-rounded">
                    <i class="fas fa-user"></i>
                    &nbsp;{{ team.role.role }}
                </span>
            {% endif %}
        </div>
        <span class="is-block is-size-6">{{team.team.description}}</span>
        <div class="level-right mt-3">
            <a class="button is-link mx-1" href={% url 'api_team_calendar' id=team.team.id %}>View</a>
            {% if team.role.role == "Owner" or team.role.role == "Co-Owner"%}
            <a class="button is-info mx-1" href={% url 'edit_team' id=team.team.id %}>Edit</a>
            {% endif %}
            <button class="button is-danger mx-1 leave-team-button"
                    id="{{ team.team.id }}"
                    onclick="openLeaveTeamModal('{{ team.team.id }}')"
            >
                Leave
            </button>
        </div>
    </div>
    {% endfor %}
    {% endif %}
    
</div>

{% include "teams/elements/leave_team_modal.html" %}

<div id="successModal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <div class="box">
            <h1 class="title">Success</h1>
            <p id="success-modal-team-message">You have successfully left the team.</p>
            <div class="buttons is-right">
                <button id="closeSuccessButton" class="button is-success">OK</button>
            </div>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>

<script src="{% static 'js/teams.js' %}" apiURL="{{ url }}"></script>
{% endblock %}